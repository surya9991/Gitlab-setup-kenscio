
# GitLab Installation & Configuration (Self-Hosted)

This document explains how to install and configure **GitLab CE** on an Ubuntu server using the **official GitLab package installation method**.

Official reference:
https://docs.gitlab.com/install/package/

---

## 1. Prerequisites
- OS: Ubuntu 20.04 / 22.04
- Root or sudo access
- Public IP or Domain name
- Required ports: 22, 80, 443

---

## 2. Enable SSH & Firewall
```bash
sudo systemctl enable --now ssh

sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable
```

Verify:
```bash
sudo ufw status

---

## 3. System Update & Dependencies
```bash
sudo apt update
sudo apt install -y curl
```

---

## 4. Add GitLab Repository (Official)
```bash
curl "https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh" | sudo bash
```

---

## 5. Install GitLab
```bash
sudo apt install -y gitlab-ce
```

---

## 6. Initial Configuration (Using Public IP)
Edit GitLab configuration:
```bash
sudo vim /etc/gitlab/gitlab.rb
```

Set:
```ruby
external_url "http://<PUBLIC-IP>"
letsencrypt['enable'] = false
```

Apply configuration:
```bash
sudo gitlab-ctl reconfigure
```

Access GitLab:
```
http://<PUBLIC-IP>
```

---

## 7. Domain Configuration (Production)
After DNS is pointed to the server:

```bash
sudo vim /etc/gitlab/gitlab.rb
```

```ruby
external_url "https://gitlab.companyname.com"
letsencrypt['enable'] = true
letsencrypt['contact_emails'] = ['admin@companyname.com']
```

Apply:
```bash
sudo gitlab-ctl reconfigure
```

---

## 8. SMTP Configuration (Email Notifications)
Edit configuration:
```bash
sudo vim /etc/gitlab/gitlab.rb
```

### Enable Email
```ruby
gitlab_rails['gitlab_email_enabled'] = true
```

### Email Identity
```ruby
gitlab_rails['gitlab_email_from'] = 'devops@companyname.com'
gitlab_rails['gitlab_email_display_name'] = 'GitLab Notifications'
gitlab_rails['gitlab_email_reply_to'] = 'devops@companyname.com'
```

### SMTP Settings (Example: Gmail)
```ruby
gitlab_rails['smtp_enable'] = true
gitlab_rails['smtp_address'] = 'smtp.gmail.com'
gitlab_rails['smtp_port'] = 587
gitlab_rails['smtp_user_name'] = 'devops@companyname.com'
gitlab_rails['smtp_password'] = '<APP_PASSWORD>'
gitlab_rails['smtp_domain'] = 'companyname.com'
gitlab_rails['smtp_authentication'] = 'login'
gitlab_rails['smtp_enable_starttls_auto'] = true
gitlab_rails['smtp_tls'] = false
gitlab_rails['smtp_openssl_verify_mode'] = 'peer'
```

Apply:
```bash
sudo gitlab-ctl reconfigure
```

---

## 9. SSL Hardening (Force HTTPS)
```bash
sudo vim /etc/gitlab/gitlab.rb
```

```ruby
external_url "https://gitlab.companyname.com"
letsencrypt['enable'] = true
letsencrypt['contact_emails'] = ['admin@companyname.com']
nginx['redirect_http_to_https'] = true
```

Apply:
```bash
sudo gitlab-ctl reconfigure
```

---

## 10. Post-Installation Checks
```bash
gitlab-ctl status
gitlab-rake gitlab:check
```

Initial root password:
```bash
sudo cat /etc/gitlab/initial_root_password
```

---

## 11. Result
- GitLab installed using official packages
- HTTPS enabled with Let's Encrypt
- SMTP configured for notifications
- Firewall & SSH secured
- Production-ready GitLab server

---

## Notes
- Replace all placeholders with environment-specific values.
- Do not store secrets in Git repositories.
